#!/bin/env ruby
require 'rbconfig'


#keystore = ARGV[0]
#value = ARGV[1]
args = ''
ARGV.each do |a|
  str = /\[(gosecret(\|[^\]\|]*){4})\]/.match(a)
  args = args + ' ' + a.gsub(/\[(gosecret(\|[^\]\|]*){4})\]/, "\"#{str}\"")
end

case RbConfig::CONFIG['arch']
  when /x86_64-linux/i
    print `#{File.expand_path File.dirname(__FILE__)}/gosecret-linux-x64 #{args}` 
  when /cygwin|mswin|mingw|bccwin|wince|emx/i
    print `#{File.expand_path File.dirname(__FILE__)}/gosecret-win-x64.exe #{args}`   
  else
    STDERR.puts "OS not supported"
end
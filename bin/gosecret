#!/bin/env ruby
require 'rbconfig'
require 'shellwords'


#keystore = ARGV[0]
#value = ARGV[1]
# args = ''
# ARGV.each do |a|
#   str = /\[(gosecret(\|[^\]\|]*){4})\]/.match(a)
#   args = args + ' ' + a.gsub(/\[(gosecret(\|[^\]\|]*){4})\]/, "\"#{str}\"")
# end

args = ARGV.map{ |a| a.gsub(/{{.*}}/, "'#{/{{.*}}/.match(a)}'") }.join(' ') # ARGV.join(' ').inspect


puts args

case RbConfig::CONFIG['arch']
  when /x86_64-linux/i
    print `#{File.expand_path File.dirname(__FILE__)}/gosecret-linux-x64 #{Shellwords.shellescape(args)}`
  when /cygwin|mswin|mingw|bccwin|wince|emx/i
    print `#{File.expand_path File.dirname(__FILE__)}/gosecret-win-x64.exe #{Shellwords.shellescape(args)}`
  when /darwin/i
    #system( "#{File.expand_path File.dirname(__FILE__)}/gosecret-darwin-x64", args)
    system "#{File.expand_path File.dirname(__FILE__)}/gosecret-darwin-x64 #{args}"
  else
    STDERR.puts "OS not supported"
end
